<% include ./partials/header %>
    

    <!--================Home Banner Area =================-->
    <!-- breadcrumb start-->
    <section class="breadcrumb breadcrumb_bg">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-12">
                    <div class="breadcrumb_iner">
                        <div class="breadcrumb_iner_item">
                            <p>Home / Category</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- breadcrumb start-->

    <!--================Category Product Area =================-->
    <section class="cat_product_area section_padding border_top">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="product_top_bar d-flex justify-content-between align-items-center">
                                <div class="single_product_menu product_bar_item">
                                    <h2>Selling Items</h2>
                                </div>
                                <div class="product_top_bar_iner product_bar_item d-flex">
                                    <a href="/upload">Upload An Item</a>    
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12 col-sm-12 grid">
                            
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--================End Category Product Area =================-->

<% include ./partials/footer %>

<script>
        var user=JSON.parse(localStorage.getItem("user"));
        var settings = {
          "url": "http://localhost:28090/product/getByUserId/"+user.id,
          "method": "GET",
          "timeout": 0,
          "headers": {
            "Content-Type": "application/x-www-form-urlencoded"
          }
        };

        $.ajax(settings).done(function (response) {
            let htmlData="";
            for(var data in response.rows){
                let innerData=response.rows[data];
                let img="";
                console.log(innerData);
                if(typeof innerData.image !== 'undefined'){
                    if(typeof innerData.image[0].path !== 'undefined'){
                        img=innerData.image[0].path
                    }
                }
                htmlData=htmlData+"<div class=\"row\" style=\"padding:10px 0px;border:1px solid #ededed;\">";
                htmlData=htmlData+"<div class=\"col-md-1\">"+innerData.id+"</div>";

                htmlData=htmlData+"<div class=\"col-md-2\"><div class=\"category_product_text\"><h5>"+innerData.name+"</h5></div></div>";

                htmlData=htmlData+"<div class=\"col-md-2\"><div class=\"category_product_text\"><p>$"+innerData.price+"</p></div></div>";

                htmlData=htmlData+"<div class=\"col-md-5 \"><div class=\"category_product_text\"><img src='"+img+"'/></div></div>";

                htmlData=htmlData+"<div class=\"col-md-2\"><a href=\"/product/"+innerData.id+"\" class=\"gridLink\" >View</a>";

                htmlData=htmlData+"<br/><a href=\"/messages/"+innerData.id+"\" class=\"gridLink\" >Messages</a>";

                if(innerData.status==0){
                htmlData=htmlData+`<br/><a href="/update/`+innerData.id+`" class="gridLink">Update Item</a>`;
                htmlData=htmlData+`<br/><a onclick="UpdateStatus(`+innerData.id+`)" class="gridLink">Mark As Sold</a>`;
                }else{
                htmlData=htmlData+`<br/><b class="gridLink">SOLD</b>`;
                }

                htmlData=htmlData+"</div>";
                htmlData=htmlData+"</div>";
            }
            $(".grid").html(htmlData);
        });

        function UpdateStatus(id){
            var update = {
              "url": "http://localhost:28090/product/changeProductStatus/",
              "method": "POST",
              "timeout": 0,
              "headers": {
                "Content-Type": "application/json"
              },
              "data": JSON.stringify({"status":1,"user_id":user.id,"id":id}),
            };

            $.ajax(update).done(function (response) {
                location.reload();
            });
        }
</script>

